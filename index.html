<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>My Personal Data Manager</title>
  <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
  <h1>Google Drive File Viewer</h1>
  <button onclick="handleAuthClick()">Sign in with Google</button>
  <button onclick="listFiles()">List My Drive Files</button>
  <ul id="file-list"></ul>

  <script>
    const CLIENT_ID = '231237450835-jt85f1eusv8rscvmkc87ah76pqkactvb.apps.googleusercontent.com';
    const API_KEY = ''; // Not needed for basic OAuth use
    const DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"];
    const SCOPES = 'https://www.googleapis.com/auth/drive.metadata.readonly';

    let tokenClient;
    let gapiInited = false;
    let gisInited = false;

    function gapiLoaded() {
      gapi.load('client', initializeGapiClient);
    }

    async function initializeGapiClient() {
      await gapi.client.init({
        apiKey: API_KEY,
        discoveryDocs: DISCOVERY_DOCS,
      });
      gapiInited = true;
    }

    function gisLoaded() {
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: '', // will be set later
      });
      gisInited = true;
    }

    function handleAuthClick() {
      tokenClient.callback = async (resp) => {
        if (resp.error) {
          alert('Authorization error');
          return;
        }
        alert('Signed in successfully');
      };

      tokenClient.requestAccessToken({ prompt: 'consent' });
    }

    async function listFiles() {
      try {
        const response = await gapi.client.drive.files.list({
          pageSize: 10,
          fields: 'files(id, name)',
        });

        const files = response.result.files;
        const list = document.getElementById('file-list');
        list.innerHTML = '';

        if (!files || files.length === 0) {
          list.innerHTML = '<li>No files found.</li>';
          return;
        }

        files.forEach(file => {
          const item = document.createElement('li');
          item.textContent = `${file.name} (${file.id})`;
          list.appendChild(item);
        });
      } catch (err) {
        console.error('Error listing files', err);
      }
    }

    // Load gapi and GIS libraries
    window.onload = () => {
      gapiLoaded();
      const script = document.createElement('script');
      script.src = 'https://accounts.google.com/gsi/client';
      script.onload = gisLoaded;
      document.body.appendChild(script);
    };
  </script>
</body>
</html>
